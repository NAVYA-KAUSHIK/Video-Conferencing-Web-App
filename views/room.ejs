<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta http-equiv="X-UA-Compatible" content="ie=edge">
   <script>
      const ROOM_ID = "<%= roomId %>"
   </script>
   
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
   
   <link rel="stylesheet" href="style.css">
   <script src="https://kit.fontawesome.com/c939d0e917.js"></script>

   <title>Meeting Room</title>
   <style>
       /* Custom tweaks for the Whiteboard Palette */
       .color-palette { display: flex; justify-content: center; gap: 10px; margin: 10px 0; }
       .color-circle { width: 25px; height: 25px; border-radius: 50%; cursor: pointer; border: 2px solid #ddd; }
       .color-circle:hover { transform: scale(1.1); }
       
       /* Fix Chat Send Button */
       .main__message_container { display: flex; align-items: center; padding: 10px; }
       .send-btn { background: transparent; border: none; color: #4285F4; font-size: 20px; margin-left: 10px; cursor: pointer; }
       
       /* Modal Tweaks */
       .modal-body i { float: right; margin: 8px; cursor: pointer; }
   </style>
</head>

<body onload="elapsedTimeIntervalRef();">
   
   <div class="modal fade" id="exampleModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
         <div class="modal-content">
            <div class="modal-header">
               <h5 class="modal-title">Participants</h5>
               <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
               <div onclick="copylink()" style="background-color:#f8f9fa; margin-bottom: 15px; border-radius: 8px; padding: 15px; cursor: pointer; border: 1px solid #eee;">
                  <span id="copyLinkText2" style="font-weight: bold; color: #4285F4;">Copy Meeting ID</span>
                  <div id="copyLinkText1" style="font-size: small; color: #555; margin-top: 5px;">
                     <%= roomId %> <i class="far fa-copy"></i>
                  </div>
               </div>
               
               <hr>
               
               <div style="margin-bottom: 10px; font-weight: bold; color: #333;">In this meeting</div>
               <div id="ParticipantsListMain" style="font-size: large;">
                  </div>
            </div>
         </div>
      </div>
   </div>

   <div class="modal fade" id="exampleModal2" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
               <h5 class="modal-title">Someone wants to join</h5>
            </div>
            <div class="modal-body">
               <p id="modalContent"></p>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="PermissionDenied">Deny</button>
               <button type="button" class="btn btn-primary" id="PermissionAccepted" data-bs-dismiss="modal">Admit</button>
            </div>
         </div>
      </div>
   </div>

   <div class="modal fade" id="exampleModal3" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Share Files</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="form">
               <div class="input-group mb-3">
                  <input type="file" class="form-control" id="inputGroupFile01">
                  <input id="upload" type="submit" value="Upload" class="btn btn-primary"/>
                </div>
           </form>
          </div>
        </div>
      </div>
    </div>

   <div class="main">
      <div class="main__top">
         <div class="main__videos">
            <div id="video-grid"></div>
            <div id="PinVideoGrid" style="display: none;"></div>
            
            <div id="sketch" style="display: none; width: 80%; position: relative;"> 
               <canvas className="board" id="board" style="background: white; border-radius:20px"></canvas>
               <div style="text-align: center; background: white; border-radius: 40px; padding: 10px;">
                  <div class="color-palette">
                      <div class="color-circle" style="background: black;" onclick="changeColor('black')"></div>
                      <div class="color-circle" style="background: red;" onclick="changeColor('red')"></div>
                      <div class="color-circle" style="background: blue;" onclick="changeColor('blue')"></div>
                      <div class="color-circle" style="background: green;" onclick="changeColor('green')"></div>
                  </div>
                  <hr style="margin: 5px;">
                  <i class="fas fa-eraser wbControls" onClick="changeColor('white')" title="Eraser"></i>
                  <button id="clr" class="wbControls">Clear Board</button>
               </div>
            </div>

            <div class="main__right">
               <div class="main__header">
                  <div class="main__header__heading">Chat Messages</div>
                  <div onclick="RemoveChatBox()" class="cross" title="Close Chat">
                     <i class="fas fa-times"></i>
                  </div>
               </div>
               <div class="main__chat_window">
                  <ul class="messages"></ul>
               </div>
               <div class="main__message_container">
                  <input id="chat_message" type="text" placeholder="Type message here...">
                  <button id="sendMsgBtn" class="send-btn" title="Send Message">
                      <i class="fas fa-paper-plane"></i>
                  </button>
               </div>
            </div>
         </div>
      </div>

      <div class="main__controls">
         <div class="main__controls__block main__controls__left">
            <div id="timest" class="time">00:00</div>
            <div class="line">|</div>
            <div id="uuid" title="Meeting ID"><%= roomId %></div>
         </div>

         <div class="main__controls__block main__controls__middle">
            <div onclick="muteUnmute()" class="main__controls__button main__mute_button" title="Mute/Unmute">
               <i class="fas fa-microphone"></i>
            </div>
            <div onclick="playStop()" class="main__controls__button main__video_button" title="Camera On/Off">
               <i class="fas fa-video"></i>
            </div>
            <div onclick="" class="main__controls__button" data-bs-toggle="modal" data-bs-target="#exampleModal3" title="Upload File">
               <i class="fas fa-file-upload"></i>
            </div>
            <div id="wbShowHide" class="main__controls__button" onClick="board()" title="Open Whiteboard">
               <i class="fas fa-pen-nib"></i>
            </div>
            <div id="start" class="main__controls__button main__Record_startbutton" title="Start Recording">
               <i class="fas fa-circle"></i>
            </div>
            <div id="stop" class="main__controls__button main__Record_button" style="display: none;" title="Stop Recording">
               <i class="fas fa-stop" style="color: red;"></i>
            </div>
            <div onclick="startScreenShare()" class="main__controls__button main__ScreenShare_button" title="Share Screen">
               <i class="fas fa-desktop"></i>
            </div>
            <div onclick="location.href='/endmeet';" class="main__controls__button bg-red" title="Leave Meeting">
               <i style="color: #fff" class="fa fa-phone"></i>
            </div>
         </div>

         <div class="main__controls__block main__controls__right">
            <div onclick="ShowChatBox()" class="main__controls__button" title="Open Chat">
               <i class="fas fa-comment-alt"></i>
            </div>
            <div onclick="ShowParticipants()" class="main__controls__button" title="Participants">
               <i class="fas fa-users"></i>
            </div>
         </div>
      </div>
   </div>
</body>

<script src="/socket.io/socket.io.js"></script>
<script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="script.js"></script>
<script src="screenShare.js"></script>
<script src="RecordMeeting.js"></script>
<script src="liveTime.js"></script>
<script src="fileUp.js"></script>
</html>